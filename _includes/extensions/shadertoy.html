<!-- Custom Shadertoy Viewer (replaces broken Shadertoy iframe) -->
<div class="extensions extensions--video">
  <div class="shadertoy-container" id="shadertoy-{{ include.id }}" style="position: relative; width: 100%; height: 450px; background: #000;">
  </div>
</div>

<script>
  (function() {
    var shaderId = '{{ include.id }}';
    var containerId = 'shadertoy-' + shaderId;

    function initViewer() {
      if (typeof THREE === 'undefined' || typeof ShadertoyViewer === 'undefined') {
        setTimeout(initViewer, 100);
        return;
      }

      var container = document.getElementById(containerId);
      if (container && !container.dataset.initialized) {
        container.dataset.initialized = 'true';

        new ShadertoyViewer(containerId, shaderId, {
          autoplay: true,
          showGui: true
        });
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initViewer);
    } else {
      initViewer();
    }
  })();
</script>
