<!-- Custom Shadertoy Viewer (replaces broken Shadertoy iframe) -->
<div class="extensions extensions--shadertoy">
  <div class="shadertoy-container" id="shadertoy-{{ include.id }}" style="position: relative; width: 100%; aspect-ratio: {{ include.aspect | default: '16 / 9' }}; background: #000; border: 1px solid #999;">
  </div>
</div>

<script>
  (function() {
    var shaderId = '{{ include.id }}';
    var containerId = 'shadertoy-' + shaderId;

    function initViewer() {
      if (typeof THREE === 'undefined' || typeof ShadertoyViewer === 'undefined') {
        setTimeout(initViewer, 100);
        return;
      }

      var container = document.getElementById(containerId);
      if (container && !container.dataset.initialized) {
        container.dataset.initialized = 'true';

        var options = {
          autoplay: {{ include.autoplay | default: true }},
          showGui: {{ include.gui | default: true }}
        };

        // Add controls configuration if provided
        {% if include.controls %}
        options.controls = {{ include.controls }};
        {% endif %}

        new ShadertoyViewer(containerId, shaderId, options);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initViewer);
    } else {
      initViewer();
    }
  })();
</script>
